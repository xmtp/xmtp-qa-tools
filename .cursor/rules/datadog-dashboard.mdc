---
description:
globs:
alwaysApply: false
---

# XMTP SDK performance dashboard

This document describes the Datadog dashboard configuration for monitoring XMTP SDK operations, network performance, and message delivery metrics.

## Dashboard configuration

- **Title**: XMTP SDK Performance
- **Description**: Metrics for XMTP SDK operations (DNS, TLS, Server Processing)
- **Layout**: Ordered layout with 16 widgets
- **Reflow type**: Fixed

## Widgets overview

### Row 1: Key performance indicators

#### Delivery rate (%)

- **Type**: Query value
- **Metric**: `avg:xmtp.sdk.delivery{$env,$region,$test,$sdk,$members}`
- **Thresholds**:
  - Green: ≥99%
  - Yellow: ≥95%
  - Red: <95%

#### Order rate (%)

- **Type**: Query value
- **Metric**: `avg:xmtp.sdk.order{$env,$region,$test,$sdk,$members}`
- **Thresholds**: Same as delivery rate

#### Average response time (ms)

- **Type**: Query value
- **Metric**: `avg:xmtp.sdk.response{$env,$region, $sdk}`
- **Thresholds**:
  - Green: ≤3000ms
  - Yellow: ≤5000ms
  - Red: >5000ms

### Row 1-3: Monitoring and logs

#### SLO list

- **Type**: SLO list
- **Filter**: Created by "Fabrizio Guespe"
- **Limit**: 100 items

#### Fail lines

- **Type**: Log stream
- **Query**: `@service:xmtp-qa-tools`
- **Columns**: status_line, timestamp, env, region, fail_lines, test

### Row 2-3: Performance analysis

#### Streams timeline

- **Type**: Time series
- **Metrics**:
  - Stream delivery: `avg:xmtp.sdk.delivery{$env,$test,$sdk,$region}`
  - Stream order: `avg:xmtp.sdk.order{$env,$region,$test,$sdk}`
- **Y-axis**: 95-100% range
- **Threshold**: 99% warning line

#### Operations performance by network

- **Type**: Time series
- **Metric**: `avg:xmtp.sdk.duration{$env,$region,$sdk,test:m_performance, $operation, metric_subtype:core} by {operation}`
- **Threshold**: 500ms error line

#### Agents response times

- **Type**: Time series
- **Metric**: `avg:xmtp.sdk.response{$env,$region, test:agents-dms, $sdk} by {agent}`
- **Grouping**: By agent

### Row 3-4: Network performance

#### Network performance

- **Type**: Time series
- **Metric**: `avg:xmtp.sdk.duration{metric_type:network,$env,$region,$test,$sdk,$members} by {network_phase}`
- **Threshold**: 250ms error line
- **Phases**: DNS lookup, TCP connection, TLS handshake, processing, server call

#### New group performance over time

- **Type**: Time series
- **Metric**: `avg:xmtp.sdk.duration{metric_subtype:group,$env,$members,test:m_large, $operation, $region} by {members}`
- **Time range**: 1 week
- **Grouping**: By member count

### Row 4-6: Detailed analysis

#### Operation performance table

- **Type**: Query table
- **Metric**: `avg:xmtp.sdk.duration{$env,$region,$test,$sdk,$members} by {operation,test,members,region,env}`
- **Sort**: By duration (descending)
- **Limit**: 500 results

#### New group performance by operation

- **Type**: Time series
- **Metric**: `avg:xmtp.sdk.duration{metric_subtype:group,$env,$members,test:m_large, $operation, $region} by {operation}`
- **Time range**: 1 week

#### Group performance by member count

- **Type**: Time series
- **Metric**: `avg:xmtp.sdk.duration{metric_subtype:group,$env,$region,$members, test:m_large, operation:newgroup} by {members,operation}`
- **Time range**: 1 week

### Row 6-7: Network comparison and geographic view

#### Network performance comparison table

- **Type**: Query table
- **Metrics**:
  - Production: `avg:xmtp.sdk.duration{metric_type:network,env:production,$region,$test,$sdk,$members} by {region,network_phase}`
  - Dev: `avg:xmtp.sdk.duration{metric_type:network,env:dev,$region,$test,$sdk,$members} by {region,network_phase}`
- **Grouping**: By region and network phase

#### Performance by region map

- **Type**: Geomap
- **Metric**: `avg:xmtp.sdk.duration{metric_type:network,network_phase:server_call, $sdk, $env} by {country_iso_code}`
- **Style**: Green to orange palette
- **View**: World focus

## Template variables

### Environment variables

```yaml
env:
  prefix: env
  values: [dev, production, local]
  default: production

region:
  prefix: region
  values: [south-america, europe, asia, us-east, us-west]
  default: us-east

test:
  prefix: test
  values: []
  default: "*"

operation:
  prefix: operation
  values: []
  default: "*"

members:
  prefix: members
  values: []
  default: "*"

sdk:
  prefix: sdk
  values: []
  default: "*"
```

### Preset configurations

#### Debugging preset

```yaml
env: local
region: south-america
test: "*"
operation: "*"
members: "*"
```

#### Regional presets

- **Asia**: region=asia, test=m_performance
- **Europe**: region=europe, test=m_performance
- **US**: region=us-east, test=m_performance

## Key metrics tracked

### Core performance metrics

- `xmtp.sdk.delivery` - Message delivery success rate
- `xmtp.sdk.order` - Message order accuracy
- `xmtp.sdk.response` - Response time for operations
- `xmtp.sdk.duration` - Operation duration timing

### Metric dimensions

- **env**: Environment (dev, production, local)
- **region**: Geographic region
- **test**: Test type (m_performance, m_large, agents-dms)
- **sdk**: SDK version
- **members**: Group member count
- **operation**: Specific operation type
- **metric_type**: network, core, group
- **metric_subtype**: core, group
- **network_phase**: DNS, TCP, TLS, processing, server_call
- **agent**: Agent identifier

### Performance thresholds

- **Delivery/Order rate**: 99% target, 95% minimum
- **Response time**: 3000ms good, 5000ms warning
- **Network operations**: 250ms threshold
- **Core operations**: 500ms threshold

## Use cases

### Monitoring operational health

- Track delivery and order rates across environments
- Monitor agent response times
- Identify performance degradation

### Performance analysis

- Compare network performance across regions
- Analyze group creation scalability
- Benchmark SDK operations

### Debugging and troubleshooting

- Review fail logs for error patterns
- Compare dev vs production performance
- Analyze geographic performance variations
