name: Group Stress
description: "should verify performance of the group streams"

on:
  pull_request:
    branches:
      - main
  workflow_dispatch:

jobs:
  test:
    timeout-minutes: 10
    runs-on: ubuntu-latest
    strategy:
      matrix:
        environment: [dev, production]
    env:
      GROUP_ID: "f4b9542616f2b58d143e3fac74152571"
      DATADOG_API_KEY: ${{ secrets.DATADOG_API_KEY }}
      XMTP_ENV: ${{ matrix.environment }}
      GEOLOCATION: ${{ vars.GEOLOCATION }}
      WORKER_COUNT: 5
      BATCH_SIZE: 50
      MAX_GROUP_SIZE: 200
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
      SLACK_CHANNEL: ${{ secrets.SLACK_CHANNEL }}
      WALLET_KEY_BOT: 0xa136b6e8891fc3516f8c8d249b39a782c837ebc27c8d534fff44de0e0c81947a
      WALLET_KEY_HENRY: 0xe3d9386b3b1a6af7ba492f467cf5ccd23d44319f7f5c71f6921765eeaa6ae631
      WALLET_KEY_IVY: 0x3baaf15c8b824f1ea8233915b790d40eb1aa177f92b62f84d47cf7e57d115096
      WALLET_KEY_JACK: 0x3c38dc4f1c424152e95689dfb0a785f155c5382b92be30ef95553a20e27c3ba7
      WALLET_KEY_KAREN: 0x01227874e57adcbea22a9805ee36196716073196fdc5509997f4677c6fce880a
      WALLET_KEY_LARRY: 0x95ba8940f0b8ffb04a7e27ef7aa15ec27d6d86d7107c80915d65ef845bc21345
      WALLET_KEY_MARY: 0x56ac7fccb0b793001f68224e3445936d11447392de9f9997273f2957fca0c1d3
      WALLET_KEY_NANCY: 0x37ac0262a8498bdc3d78d2f91d564dd277698db04b767eb7b412e821a8947375
      WALLET_KEY_OSCAR: 0xdcce624772b2da75ad4570d1bd39d094f000f6a42260f780ddd504f34009ea51
      WALLET_KEY_BOB: 0x87f75520933653b948445739516ecc41e777cb7598e6f3f6ee7181c674d4f977
      WALLET_KEY_ALICE: 0xb060e5e221be3aee6c3bb087aa2245705f243a3e33c9ae004c7c2a5101599485
      WALLET_KEY_FABRI: 0x7f2ca60a0f6dba393c3b6c05fccbedacfcb520c48a3d4ab584e99f83cefc7196
      WALLET_KEY_ELON: 0x3af53ebf22a3f67db236cafc7e865cfd8af0d046d869aa5456c81ac1df934108
      WALLET_KEY_JOE: 0x193e8408a4d8c20211580b03919a515be5c69cb30c99a5a3a656f003492a9772
      WALLET_KEY_DAVE: 0xf712fdca463314c072d8babd2b720b45b51f27b7a64539e5e658b3c59a1b2966
      WALLET_KEY_EVE: 0x5a0a9b2e14d106fa00357232175f7b0d159c6055c3917d2e41aa6e1f1e607d59
      WALLET_KEY_CHARLIE: 0x7cdb36e46f0d5e390ac3cedfcf79df4a5ee675a6cede2e3e23e7b3d6380ac684
      WALLET_KEY_FRANK: 0x67ec1cf818db023d0eaa3b9caddebae0daa816f554e12c8e8f42f0f314ca8dce
      WALLET_KEY_GRACE: 0x18fc66495754096e6ef1b97ca350e31c8adc4c1e4fd44969289a34310a79cff8
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version-file: ".node-version"
          cache: "yarn"
      - name: Install dependencies
        run: yarn
      - name: Run tests
        run: yarn test group-stress
      - name: Upload test artifacts
        uses: actions/upload-artifact@v4
        with:
          name: artifacts-${{ matrix.environment }}
          path: |
            logs/**/*
            .data/**/*
            .env
          if-no-files-found: ignore
          overwrite: true
          include-hidden-files: true
          retention-days: 90
