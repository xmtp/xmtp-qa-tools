name: Not Forked
description: "should verify that the code is not forked"

on:
  pull_request:
    branches:
      - main
  workflow_dispatch:

jobs:
  test:
    timeout-minutes: 10
    runs-on: ubuntu-latest
    strategy:
      matrix:
        environment: [production]
    env:
      GROUP_ID: "f4b9542616f2b58d143e3fac74152571"
      DATADOG_API_KEY: ${{ secrets.DATADOG_API_KEY }}
      XMTP_ENV: ${{ matrix.environment }}
      GEOLOCATION: ${{ vars.GEOLOCATION }}
      WORKER_COUNT: 5
      BATCH_SIZE: 50
      MAX_GROUP_SIZE: 200
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
      SLACK_CHANNEL: ${{ secrets.SLACK_CHANNEL }}
      WALLET_KEY_BOT: "0xa136b6e8891fc3516f8c8d249b39a782c837ebc27c8d534fff44de0e0c81947a"
      WALLET_KEY_HENRY: "0xe3d9386b3b1a6af7ba492f467cf5ccd23d44319f7f5c71f6921765eeaa6ae631"
      WALLET_KEY_IVY: "0x3baaf15c8b824f1ea8233915b790d40eb1aa177f92b62f84d47cf7e57d115096"
      WALLET_KEY_JACK: "0x3c38dc4f1c424152e95689dfb0a785f155c5382b92be30ef95553a20e27c3ba7"
      WALLET_KEY_KAREN: "0x01227874e57adcbea22a9805ee36196716073196fdc5509997f4677c6fce880a"
      WALLET_KEY_LARRY: "0x95ba8940f0b8ffb04a7e27ef7aa15ec27d6d86d7107c80915d65ef845bc21345"
      WALLET_KEY_MARY: "0x56ac7fccb0b793001f68224e3445936d11447392de9f9997273f2957fca0c1d3"
      WALLET_KEY_NANCY: "0x37ac0262a8498bdc3d78d2f91d564dd277698db04b767eb7b412e821a8947375"
      WALLET_KEY_OSCAR: "0xdcce624772b2da75ad4570d1bd39d094f000f6a42260f780ddd504f34009ea51"
      WALLET_KEY_BOB: "0x87f75520933653b948445739516ecc41e777cb7598e6f3f6ee7181c674d4f977"
      WALLET_KEY_ALICE: "0xb060e5e221be3aee6c3bb087aa2245705f243a3e33c9ae004c7c2a5101599485"
      WALLET_KEY_FABRI: "0x7f2ca60a0f6dba393c3b6c05fccbedacfcb520c48a3d4ab584e99f83cefc7196"
      WALLET_KEY_ELON: "0x3af53ebf22a3f67db236cafc7e865cfd8af0d046d869aa5456c81ac1df934108"
      WALLET_KEY_JOE: "0x193e8408a4d8c20211580b03919a515be5c69cb30c99a5a3a656f003492a9772"
      WALLET_KEY_DAVE: "0xf712fdca463314c072d8babd2b720b45b51f27b7a64539e5e658b3c59a1b2966"
      WALLET_KEY_EVE: "0x5a0a9b2e14d106fa00357232175f7b0d159c6055c3917d2e41aa6e1f1e607d59"
      WALLET_KEY_CHARLIE: "0x7cdb36e46f0d5e390ac3cedfcf79df4a5ee675a6cede2e3e23e7b3d6380ac684"
      WALLET_KEY_FRANK: "0x67ec1cf818db023d0eaa3b9caddebae0daa816f554e12c8e8f42f0f314ca8dce"
      WALLET_KEY_GRACE: "0x18fc66495754096e6ef1b97ca350e31c8adc4c1e4fd44969289a34310a79cff8"
      ENCRYPTION_KEY_BOT: "abf5b16184b67d228246771094982edbde3d35a490a0ab0422e2248394e0cc62"
      ENCRYPTION_KEY_HENRY: "b1bfd18bd71889216148a623fafd5168d04eadc55180d1868a7246207bf1d637"
      ENCRYPTION_KEY_IVY: "076ea51b5425bc1e6f2bfd4fbd6ac1f1f36a6f99fb79cbc42c045f34cdb6ef59"
      ENCRYPTION_KEY_JACK: "f40aba0e416ed577e9198f30741193aec6a197fc97184f925fc1b2c97c7bff5d"
      ENCRYPTION_KEY_KAREN: "c3f2d8a343e4933b11090ade099c204c5b87ba4fd3ec85c8e886ea9857c41f29"
      ENCRYPTION_KEY_LARRY: "9cdca3547caed4357b11267f1dac9caf4892afa18164048151cc95d4fd7eb217"
      ENCRYPTION_KEY_MARY: "9b1ed8ff5c87b0ef83f639d8906c9569abb836c059196a4ea50edd62a8c6a14f"
      ENCRYPTION_KEY_NANCY: "f5a7cdd34a8ba1d225a05aacb4b0ce7c678fd304496440dafeb2f41f1f906444"
      ENCRYPTION_KEY_OSCAR: "74ee312b949b44824db111a6d1904caef09bf60abb1a9c02c41f3151f38a231a"
      ENCRYPTION_KEY_BOB: "07fe57d27032ba3287364b5bff5ea0e88ac0d27ea612ec30b0704f324d49045c"
      ENCRYPTION_KEY_ALICE: "0e641d219b4913d9fad3384a0a70153d67773f9bb5ca7de865d119d359d163fd"
      ENCRYPTION_KEY_FABRI: "9074657df2443f149286ac6362e3a186411d2188c0a93fec168e8e696b7b7401"
      ENCRYPTION_KEY_ELON: "2575e3067ec74b508996ae8e22f8644db391a64c48cd96652180888c0d327d50"
      ENCRYPTION_KEY_JOE: "36aeaf0e2adff67c5437a7d9146a5d9843a3e39106caecfa33ff81804bd57f2e"
      ENCRYPTION_KEY_DAVE: "d31bb8cba88fea9ab7eb60926c4bef64b80556a2b470cd9c0128b1cf70224d59"
      ENCRYPTION_KEY_EVE: "0966d2c4a1caf76e1cfc60844af31a1118a73733cc13e17cba66442b0111a1e9"
      ENCRYPTION_KEY_CHARLIE: "1e843b6c59778a1de922bbe5edf627748f1c34b3b22759d861c00a39ebffe9fb"
      ENCRYPTION_KEY_FRANK: "d930b6034e6fce9707bafa81b7072deea409a4c5bf6399349602e925bd634927"
      ENCRYPTION_KEY_GRACE: "f0c7f6bc366d2e50ec38f1a36358394db9502e563bc504fbf60fed0f2a792461"
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version-file: ".node-version"
          cache: "yarn"
      - name: Cache XMTP data
        uses: actions/cache@v4
        with:
          path: .data
          key: not-forked-${{ matrix.environment }}
          restore-keys: |
            not-forked-${{ matrix.environment }}
      - name: Install dependencies
        run: yarn
      - name: Run tests
        run: yarn test group-stress
      - name: Save cache
        uses: actions/cache@v4
        with:
          path: .data
          key: not-forked-${{ matrix.environment }}
          restore-keys: |
            not-forked-${{ matrix.environment }}
      - name: Upload test artifacts
        uses: actions/upload-artifact@v4
        with:
          name: artifacts-${{ matrix.environment }}
          path: |
            logs/**/*
            .data/**/*
            .env
          if-no-files-found: ignore
          overwrite: true
          include-hidden-files: true
          retention-days: 90
