# Agent SDK version management

### Upgrade procedure

When upgrading XMTP agent-sdk versions:

1. Add `@xmtp/agent-sdk-X.X.X` to package.json.
2. Add import for new Agent SDK version to `agents/versions.ts`.
3. Add entry to `AgentVersionList` with corresponding `nodeSDK` version.
4. Run `yarn versions` to link agent SDK versions to their required node SDK versions.
5. Run `yarn regression` to check regression of latest versions.

### Version mapping system

Versions are mapped in `agents/versions.ts`:

```typescript
export const AgentVersionList = [
  {
    Agent: Agent12,
    MessageContext: MessageContext12,
    agentSDK: "1.2.0",
    nodeSDK: "4.5.0",
    auto: true, // Include in automated testing
  },
  {
    Agent: Agent11,
    MessageContext: MessageContext11,
    agentSDK: "1.1.0",
    nodeSDK: "4.4.0",
    auto: true,
  },
];
```

### Package aliases

Multiple versions installed via npm aliases:

```json
{
  "dependencies": {
    "@xmtp/agent-sdk-1.2.0": "npm:@xmtp/agent-sdk@1.2.1",
    "@xmtp/agent-sdk-1.1.0": "npm:@xmtp/agent-sdk@1.1.16"
  }
}
```

### Dynamic linking

`yarn versions` creates symlinks linking agent SDK versions to their required node SDK versions:

```bash
node_modules/@xmtp/
├── agent-sdk-1.2.0/
│   └── node_modules/@xmtp/
│       └── node-sdk -> ../../node-sdk-4.5.0/
└── node-sdk-4.5.0/
```

### Using environment variables

Select a specific agent SDK version:

```bash
AGENT_SDK_VERSION=1.1.0 yarn bot key-check
```

### Version detection

Detect which agent SDK version is being used:

```typescript
import { detectAgentSDKVersion, getActiveAgentVersion } from "@agents/versions";

const version = detectAgentSDKVersion(AgentClass);
const activeVersion = getActiveAgentVersion(0); // Get latest auto-enabled version
```

### Using versions command

```bash
yarn versions
# shows current agent SDK → node SDK mappings
```

### Testing specific versions

```bash
AGENT_SDK_VERSION=1.2.0 yarn test performance
yarn bot key-check --agentSDK 1.1.0
```
